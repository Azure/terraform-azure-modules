# CHANGELOG

We use CHANGELOG.md  file to help tests and some other automated workflows, it's generated by GitHub action, the auto generation code can be seen here [example of `terraform-azurerm-aks`](https://github.com/Azure/terraform-azurerm-aks/blob/master/.github/workflows/update-changelog.yaml).

We use the name of CHANGELOG.md to help verifying the next major version. For example, in a code repo there are files like these:

```text
.
├── CHANGELOG-v4.md
├── CHANGELOG-v5.md
├── CHANGELOG.md
```

The latest version of the past major release is `v5`, so the next version going be released will be `6`. Assuming there is only `CHANGELOG.md` file under the current directory, then the major version number will be `0`.

[Version upgrade tests](/test_code/version_upgrade_tests.md) are also based on this. It will verify the major version going to be released, then try to clone the latest code in this major version and perform version upgrade tests with the current PR version. If the major version going to be released does not have a tag, then the version upgrade tests will be skipped.

The auto generation of CHANGELOG will be triggered once the default branch in the repo received a `push`, it will collect all the pull request information from the first version after the current major version and put them in CHANGELOG.

When we merged a PR contains a breaking change, we need to:

1. Make a copy of the current `CHANGELOG.md`, name it `CHANGELOG-v<CURRENT_MAJOR_VERSION>.md`, Eg. the current major version is `5`, we should have a `CHANGELOG-v4.md` and a `CHANGELOG.md` file in the directory. We need to copy `CHANGELOG.md` to `CHANGELOG-v5.md`.
2. Remove the part marked as `Unreleased` in the new file (in this part the unreleased PRs will be released in the next major version)
3. Remove the content in `CHANGELOG.md`
4. Submit the changes to the repo, after the workflow finished updating the new `CHANGELOG.md`, run `git pull` again.